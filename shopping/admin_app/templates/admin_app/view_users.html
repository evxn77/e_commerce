{% extends 'base.html' %}
{% block content %}

<header style="margin-bottom: 3rem; display: flex; justify-content: space-between; align-items: center;">
    <div>
        <h1 style="font-size: 2.5rem; font-weight: 800;">User <span style="color:var(--accent)">Directory</span></h1>
        <p style="color: var(--text-muted);">Monitor and manage vault access permissions.</p>
    </div>
</header>

<div style="margin-bottom: 2rem; position: relative; max-width: 500px;">
    <span style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--text-muted); opacity: 0.5;">üîç</span>
    <input type="text" id="userSearch" placeholder="Search by username, email or ID..." 
           style="width: 100%; padding: 18px 20px 18px 50px; background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-radius: 15px; color: white; font-size: 0.9rem; outline: none; transition: 0.3s;">
</div>

<div class="card" style="padding: 0; overflow: hidden; border-radius: 20px;">
    <table id="userTable" style="width: 100%; border-collapse: collapse; text-align: left;">
        <thead>
            <tr style="background: rgba(255,255,255,0.05); border-bottom: 1px solid var(--glass-border);">
                <th style="padding: 22px; font-size: 0.7rem; color: var(--accent); text-transform: uppercase; letter-spacing: 2px;">Identity</th>
                <th style="padding: 22px; font-size: 0.7rem; color: var(--accent); text-transform: uppercase; letter-spacing: 2px;">Email Contact</th>
                <th style="padding: 22px; font-size: 0.7rem; color: var(--accent); text-transform: uppercase; letter-spacing: 2px;">Access Date</th>
                <th style="padding: 22px; font-size: 0.7rem; color: var(--accent); text-transform: uppercase; letter-spacing: 2px;">Clearance</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr style="border-bottom: 1px solid var(--glass-border); transition: 0.3s;" class="user-row">
                <td style="padding: 22px;">
                    <div style="font-weight: 700; font-size: 1.1rem;">{{ user.username }}</div>
                    <div style="font-size: 0.7rem; color: var(--text-muted); font-family: monospace;">UID: 00{{ user.id }}</div>
                </td>
                <td style="padding: 22px; color: var(--text-muted);">{{ user.email|default:"No email linked" }}</td>
                <td style="padding: 22px; font-size: 0.85rem;">{{ user.date_joined|date:"d M, Y" }}</td>
                <td style="padding: 22px;">
                    {% if user.is_staff %}
                        <span style="background: rgba(0, 242, 255, 0.1); color: var(--accent); padding: 6px 15px; border-radius: 50px; font-size: 0.65rem; font-weight: 800; border: 1px solid var(--accent);">LEVEL: ADMIN</span>
                    {% else %}
                        <span style="background: rgba(255, 255, 255, 0.05); color: var(--text-muted); padding: 6px 15px; border-radius: 50px; font-size: 0.65rem; font-weight: 600; border: 1px solid rgba(255,255,255,0.1);">LEVEL: USER</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    // Real-time Search Logic
    document.getElementById('userSearch').addEventListener('keyup', function() {
        let searchValue = this.value.toLowerCase();
        let rows = document.querySelectorAll('.user-row');
        
        rows.forEach(row => {
            let content = row.innerText.toLowerCase();
            if (content.includes(searchValue)) {
                row.style.display = "";
                row.style.opacity = "1";
            } else {
                row.style.display = "none";
                row.style.opacity = "0";
            }
        });
    });

    // Style Focus on Search
    const searchInput = document.getElementById('userSearch');
    searchInput.onfocus = () => searchInput.style.borderColor = 'var(--accent)';
    searchInput.onblur = () => searchInput.style.borderColor = 'var(--glass-border)';
</script>

{% endblock %}